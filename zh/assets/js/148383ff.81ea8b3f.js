(self.webpackChunksmartlink_doc=self.webpackChunksmartlink_doc||[]).push([[1540],{86711:(e,t,s)=>{"use strict";s.r(t),s.d(t,{assets:()=>y,contentTitle:()=>f,default:()=>j,frontMatter:()=>x,metadata:()=>g,toc:()=>b});var a=s(86070),r=s(25710),n=s(43419),l=s(29336),i=s(36513),o=s(27449),c=s(30758),d=s(92259),u=s(29916),m=s(1553);class h{setChannel(e,t,s,a){this.name=t,this.onSend=s,this.onReceive=a,this.otherend=e}static createBidirectionnal(){const e=new h,t=new h;return e.setChannel(t),t.setChannel(e),e}static createEncryptedBidirectionnal(e){e=e||i.default.generateKey();const t=i.default.encryptChannel(new h,e),s=i.default.encryptChannel(new h,e);return t.setChannel(s),s.setChannel(t),t}async send(e){for(;!this.otherend?.resolver;)await(0,m.cb)(100);this.onSend&&await this.onSend(e),this.otherend?.onReceive&&await(this.otherend?.onReceive(e)),this.otherend?.resolver(e)}async start(){}fromConnectionString(e){return new h}getConnectionString(){return""}async receive(){return new Promise((e=>this.resolver=e))}async close(){}}const p=()=>{const[e,t]=(0,c.useState)(),[s,r]=(0,c.useState)(),[p,x]=(0,c.useState)(),[f,g]=(0,c.useState)(),[y,b]=(0,c.useState)(),[w,j]=(0,c.useState)(!1),[v,N]=(0,c.useState)(),[k,S]=(0,c.useState)(),C=(0,c.useRef)([]),[I,B]=(0,c.useState)(0),V=(e,t)=>async s=>{N(s.toString("base64"));const a=((e,t)=>(0,i.decrypt)(e,t))(s,t),r=(0,n.D4)(a);return S((0,m.du)(r)),e(r)},R=e=>{let{step:t=1,animate:s=!0}=e;return(0,a.jsxs)("div",{className:"w-full relative my-5",children:[(0,a.jsx)("span",{className:"absolute left-0 w-full bg-green-400 h-1"}),(0,a.jsx)("span",{className:(s?"animate-slide-right":"translate-x-0")+" absolute -top-3  h-8 w-full",children:(0,a.jsx)("span",{className:"bg-green-500 dark:bg-green-700 h-6 w-6 rounded-full px-2",children:t})})]})},D=e=>{let{step:t=2,animate:s=!0}=e;return(0,a.jsxs)("div",{className:"w-full relative my-5",children:[(0,a.jsx)("span",{className:"absolute left-0 w-full bg-green-400 h-1"}),(0,a.jsx)("span",{className:(s?"animate-slide-left":"-translate-x-full")+" absolute -top-3  h-8 w-full",children:(0,a.jsx)("span",{className:"bg-green-500 dark:bg-green-700 h-6 w-6 rounded-full px-2",children:t})})]})},_=e=>{let{error:t}=e;return(0,a.jsxs)("div",{className:"w-full relative my-5",children:[(0,a.jsx)("div",{className:"text-xs",children:t}),(0,a.jsx)("span",{className:"absolute left-0 w-full bg-red-400 h-1"})]})},A=(e,t)=>async s=>(C.current.push({direction:t,animate:!0}),B(Math.random()),await(0,m.cb)(2e3),e(s)),M=async function(e){void 0===e&&(e="software");let s=await l.VaultysId.generatePerson();if("passkey"==e?s=await(0,m.vX)(!0):"fido2"==e&&(s=await(0,m.vX)(!1)),s){const e=s.toVersion(0),a=(0,o.MemoryStorage)((()=>{})),r=new l.IdManager(e,a);t(r)}};(0,c.useEffect)((()=>{(async()=>{if(!s){const e=(await l.VaultysId.generatePerson()).toVersion(0),t=(0,o.MemoryStorage)((()=>{})),s=new l.IdManager(e,t);r(s)}})()}),[]);const P=e=>{let{certificate:t}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("li",{className:"flex flex-row items-center",children:["protocol ",[t?.protocol,t?.service].join(t?"/":"")]}),(0,a.jsxs)("li",{className:"flex flex-row items-center",children:[t?.pk1?(0,a.jsx)(d.maZ,{className:"-rotate-45 fill-green-500 h-8 w-8"}):(0,a.jsx)(d.maZ,{className:"-rotate-45 fill-slate-500 h-8 w-8"}),t?.sign1||t?.sign1?(0,a.jsx)(d.waL,{className:"fill-green-500 h-8 w-8"}):(0,a.jsx)(d.v6F,{className:"animate-spin fill-slate-500 h-8 w-8"}),"Bob"]}),(0,a.jsxs)("li",{className:"flex flex-row items-center",children:[t?.pk2?(0,a.jsx)(d.maZ,{className:"-rotate-45 fill-green-500 h-8 w-8"}):(0,a.jsx)(d.maZ,{className:"-rotate-45 fill-slate-500 h-8 w-8"}),t?.sign2?(0,a.jsx)(d.waL,{className:"fill-green-500 h-8 w-8"}):(0,a.jsx)(d.v6F,{className:"animate-spin fill-slate-500 h-8 w-8"}),"Alice"]})]})},E=e=>{let{id:t,name:s="Alice",sex:r="woman",certificate:n}=e;return t?(0,a.jsxs)("div",{className:"flex flex-col gap-5 items-center bg-slate-200 dark:bg-slate-800 rounded p-5",children:[(0,a.jsxs)("div",{className:" flex flex-col md:flex-row justify-center items-center gap-5",children:[(0,a.jsx)(u.A,{...(0,u.D)(t.vaultysId.fingerprint),hairStyle:"man"==r?"thick":"womanLong",className:"w-20 h-20"}),s]}),(0,a.jsx)("div",{className:"font-mono text-xs font-bold w-48 hidden md:block",children:t.vaultysId.fingerprint}),(0,a.jsx)("div",{className:"w-full",children:0===n?(0,a.jsx)("div",{className:"bg-red-500 p-5 rounded border-red-700 dark:border-red-300 border-solid border",children:"Error"}):(0,a.jsx)(P,{certificate:n})})]}):(0,a.jsxs)("div",{className:"flex flex-col gap-5 items-center bg-slate-200 dark:bg-slate-800 rounded p-5",children:[(0,a.jsx)("div",{children:"Which way do you want to secure Bob Id?"}),(0,a.jsx)("button",{className:"p-2 rounded-lg cursor-pointer",onClick:()=>M("passkey"),children:"Passkey"}),(0,a.jsx)("button",{className:"p-2 rounded-lg cursor-pointer",onClick:()=>M("fido2"),children:"Fido2 Key"}),(0,a.jsx)("button",{className:"p-2 rounded-lg cursor-pointer transition-all",onClick:()=>M("software"),children:"Software"})]})};return(0,a.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,a.jsxs)("div",{className:"grid grid-cols-3",children:[(0,a.jsx)(E,{name:"Bob",id:e,sex:"man",certificate:f}),(0,a.jsxs)("div",{className:"flex flex-col gap-5 text-center items-center",children:[(0,a.jsx)("button",{disabled:w||!e,className:"rounded bg-slate-300 dark:bg-slate-700 shadow-lg p-5 border-0 cursor-pointer hover:shadow-md active:shadow-none",onClick:()=>{(async()=>{j(!0),C.current=[],x(void 0),g(void 0);const t=i.default.generateKey();b(t);const a=h.createEncryptedBidirectionnal(t);a.onSend=V(g,t),a.onReceive=V(A(g,"alice"),t),a.otherend.onSend=V(x,t),a.otherend.onReceive=V(A(x,"bob"),t);try{await Promise.all([e?.askContact(a),s?.acceptContact(a.otherend)])}catch(r){C.current.push({direction:"error",animate:!1,error:r.message})}j(!1)})()},children:"Start"}),y&&(0,a.jsxs)("div",{className:"text-xs hidden lg:block",children:["Encryption key: ",y.toString("base64")]}),(()=>{const e=[],t=C.current;for(let s=0;s<t.length;s++)"bob"==t[s].direction?e.push((0,a.jsx)(R,{step:s+1,animate:t[s].animate})):"alice"==t[s].direction?e.push((0,a.jsx)(D,{step:s+1,animate:t[s].animate})):"error"==t[s].direction&&e.push((0,a.jsx)(_,{error:t[s].error})),C.current=C.current.map((e=>({...e,animate:!1})));return e})()]},I),(0,a.jsx)(E,{name:"Alice",sex:"woman",id:s,certificate:p})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5 border border-slate-500 rounded border-solid p-5",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,a.jsx)("div",{className:"text-lg font-bold",children:"Encrypted"}),(0,a.jsx)("pre",{className:"whitespace-normal",children:v})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,a.jsx)("div",{className:"text-lg font-bold",children:"Decrypted"}),(0,a.jsx)("pre",{children:k})]})]})})]})},x={hide_table_of_contents:!0},f="Simulator",g={id:"develop/try/simulation",title:"Simulator",description:"",source:"@site/docs/develop/try/simulation.mdx",sourceDirName:"develop/try",slug:"/develop/try/simulation",permalink:"/zh/docs/develop/try/simulation",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{hide_table_of_contents:!0},sidebar:"userguideSidebar",previous:{title:"VaultysID",permalink:"/zh/docs/develop/try/did"},next:{title:"WebRTC",permalink:"/zh/docs/develop/try/webrtc"}},y={},b=[];function w(e){const t={h1:"h1",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"simulator",children:"Simulator"}),"\n",(0,a.jsx)(p,{})]})}function j(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(w,{...e})}):w(e)}},1553:(e,t,s)=>{"use strict";s.d(t,{cb:()=>l,du:()=>c,vX:()=>o});var a=s(29336),r=s(2080),n=s(84686).Buffer;const l=e=>new Promise((t=>setTimeout(t,e))),i=e=>{const t=/^((?!chrome|android).)*applewebkit/i.test(navigator.userAgent);return{challenge:(0,r.randomBytes)(32),rp:{name:"Vaultys ID"},user:{id:(0,r.randomBytes)(16),name:"Vaultys ID",displayName:"Vaultys Wallet ID"},attestation:t?"none":"direct",authenticatorSelection:{authenticatorAttachment:e?"platform":"cross-platform",residentKey:e?"required":"discouraged",userVerification:"preferred"},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-8},{type:"public-key",alg:-257}]}},o=async e=>{const t=await navigator.credentials.create({publicKey:i(e)});return t?await a.VaultysId.fido2FromAttestation(t):null},c=e=>JSON.stringify(e,((e,t)=>t?.data&&"Buffer"==t?.type?n.from(t.data).toString("base64"):t),2)},34654:()=>{},34149:()=>{},89780:()=>{},13495:()=>{},99926:()=>{},90124:()=>{},71220:()=>{},38854:()=>{},98308:()=>{}}]);