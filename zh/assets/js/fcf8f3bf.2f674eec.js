(self.webpackChunksmartlink_doc=self.webpackChunksmartlink_doc||[]).push([[7933],{30604:(e,t,r)=>{"use strict";r.r(t),r.d(t,{assets:()=>y,contentTitle:()=>p,default:()=>j,frontMatter:()=>x,metadata:()=>g,toc:()=>b});var s=r(86070),n=r(62907),a=r(45777),i=r(82846),l=r(63669),o=r(86317),c=r(30758),d=r(58359),u=r(72940),h=r(16899),m=r(39287);const f=()=>{const[e,t]=(0,c.useState)(),[r,n]=(0,c.useState)(),[f,x]=(0,c.useState)(),[p,g]=(0,c.useState)(),[y,b]=(0,c.useState)(),[w,j]=(0,c.useState)(!1),[v,N]=(0,c.useState)(),[S,B]=(0,c.useState)(),k=(0,c.useRef)([]),[C,I]=(0,c.useState)(0),_=(e,t)=>async r=>{N(r.toString("base64"));const s=((e,t)=>(0,l.Yc)(e,t))(r,t),n=(0,a.D4)(s);return B((0,h.du)(n)),e(n)},A=e=>{let{step:t=1,animate:r=!0}=e;return(0,s.jsxs)("div",{className:"w-full relative my-5",children:[(0,s.jsx)("span",{className:"absolute left-0 w-full bg-green-400 h-1"}),(0,s.jsx)("span",{className:(r?"animate-slide-right":"translate-x-0")+" absolute -top-3  h-8 w-full",children:(0,s.jsx)("span",{className:"bg-green-500 dark:bg-green-700 h-6 w-6 rounded-full px-2",children:t})})]})},M=e=>{let{step:t=2,animate:r=!0}=e;return(0,s.jsxs)("div",{className:"w-full relative my-5",children:[(0,s.jsx)("span",{className:"absolute left-0 w-full bg-green-400 h-1"}),(0,s.jsx)("span",{className:(r?"animate-slide-left":"-translate-x-full")+" absolute -top-3  h-8 w-full",children:(0,s.jsx)("span",{className:"bg-green-500 dark:bg-green-700 h-6 w-6 rounded-full px-2",children:t})})]})},P=e=>{let{error:t}=e;return(0,s.jsxs)("div",{className:"w-full relative my-5",children:[(0,s.jsx)("div",{className:"text-xs",children:t}),(0,s.jsx)("span",{className:"absolute left-0 w-full bg-red-400 h-1"})]})},F=(e,t)=>async r=>(k.current.push({direction:t,animate:!0}),I(Math.random()),await(0,h.cb)(2e3),e(r)),R=async function(e){void 0===e&&(e="software");let r=await i.VaultysId.generatePerson();if("passkey"==e?r=await(0,h.vX)(!0):"fido2"==e&&(r=await(0,h.vX)(!1)),r){const e=(0,o.XG)((()=>{})),s=new i.IdManager(r,e);t(s)}};(0,c.useEffect)((()=>{(async()=>{if(!r){const e=await i.VaultysId.generatePerson(),t=(0,o.XG)((()=>{})),r=new i.IdManager(e,t);n(r)}})()}),[]);const E=e=>{let{certificate:t}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("li",{className:"flex flex-row items-center",children:["protocol ",[t?.protocol,t?.service].join(t?"/":"")]}),(0,s.jsxs)("li",{className:"flex flex-row items-center",children:[t?.pk1?(0,s.jsx)(d.maZ,{className:"-rotate-45 fill-green-500 h-8 w-8"}):(0,s.jsx)(d.maZ,{className:"-rotate-45 fill-slate-500 h-8 w-8"}),t?.sign1||t?.sign1?(0,s.jsx)(d.waL,{className:"fill-green-500 h-8 w-8"}):(0,s.jsx)(d.v6F,{className:"animate-spin fill-slate-500 h-8 w-8"}),"Bob"]}),(0,s.jsxs)("li",{className:"flex flex-row items-center",children:[t?.pk2?(0,s.jsx)(d.maZ,{className:"-rotate-45 fill-green-500 h-8 w-8"}):(0,s.jsx)(d.maZ,{className:"-rotate-45 fill-slate-500 h-8 w-8"}),t?.sign2?(0,s.jsx)(d.waL,{className:"fill-green-500 h-8 w-8"}):(0,s.jsx)(d.v6F,{className:"animate-spin fill-slate-500 h-8 w-8"}),"Alice"]})]})},D=e=>{let{id:t,name:r="Alice",sex:n="woman",certificate:a}=e;return t?(0,s.jsxs)("div",{className:"flex flex-col gap-5 items-center bg-slate-200 dark:bg-slate-800 rounded p-5",children:[(0,s.jsxs)("div",{className:" flex flex-col md:flex-row justify-center items-center gap-5",children:[(0,s.jsx)(u.A,{...(0,u.D)(t.vaultysId.fingerprint),hairStyle:"man"==n?"thick":"womanLong",hatStyle:"none",className:"w-20 h-20"}),r]}),(0,s.jsx)("div",{className:"font-mono text-xs font-bold w-48 hidden md:block",children:t.vaultysId.fingerprint}),(0,s.jsx)("div",{className:"w-full",children:0===a?(0,s.jsx)("div",{className:"bg-red-500 p-5 rounded border-red-700 dark:border-red-300 border-solid border",children:"Error"}):(0,s.jsx)(E,{certificate:a})})]}):(0,s.jsxs)("div",{className:"flex flex-col gap-5 items-center bg-slate-200 dark:bg-slate-800 rounded p-5",children:[(0,s.jsx)("div",{children:"Which way do you want to secure Bob Id?"}),(0,s.jsx)("button",{className:"p-2 rounded-lg cursor-pointer",onClick:()=>R("passkey"),children:"Passkey"}),(0,s.jsx)("button",{className:"p-2 rounded-lg cursor-pointer",onClick:()=>R("fido2"),children:"Fido2 Key"}),(0,s.jsx)("button",{className:"p-2 rounded-lg cursor-pointer transition-all",onClick:()=>R("software"),children:"Software"})]})};return(0,s.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3",children:[(0,s.jsx)(D,{name:"Bob",id:e,sex:"man",certificate:p}),(0,s.jsxs)("div",{className:"flex flex-col gap-5 text-center items-center",children:[(0,s.jsx)("button",{disabled:w||!e,className:"rounded bg-slate-300 dark:bg-slate-700 shadow-lg p-5 border-0 cursor-pointer hover:shadow-md active:shadow-none",onClick:()=>{(async()=>{j(!0),k.current=[],x(void 0),g(void 0);const t=l.Ay.generateKey();b(t);const s=m.n.createEncryptedBidirectionnal(t);s.onSend=_(g,t),s.onReceive=_(F(g,"alice"),t),s.otherend.onSend=_(x,t),s.otherend.onReceive=_(F(x,"bob"),t);try{await Promise.all([e?.askContact(s),r?.acceptContact(s.otherend)])}catch(n){k.current.push({direction:"error",animate:!1,error:n.message})}j(!1)})()},children:"Start"}),y&&(0,s.jsxs)("div",{className:"text-xs hidden lg:block",children:["Encryption key: ",y.toString("base64")]}),(()=>{const e=[],t=k.current;for(let r=0;r<t.length;r++)"bob"==t[r].direction?e.push((0,s.jsx)(A,{step:r+1,animate:t[r].animate},r)):"alice"==t[r].direction?e.push((0,s.jsx)(M,{step:r+1,animate:t[r].animate},r)):"error"==t[r].direction&&e.push((0,s.jsx)(P,{error:t[r].error},r)),k.current=k.current.map((e=>({...e,animate:!1})));return e})()]},C),(0,s.jsx)(D,{name:"Alice",sex:"woman",id:r,certificate:f})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5 border border-slate-500 rounded border-solid p-5",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,s.jsx)("div",{className:"text-lg font-bold",children:"Encrypted"}),(0,s.jsx)("pre",{className:"whitespace-normal",children:v})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,s.jsx)("div",{className:"text-lg font-bold",children:"Decrypted"}),(0,s.jsx)("pre",{children:S})]})]})})]})},x={hide_table_of_contents:!0,sidebar_position:2},p="\u6a21\u62df\u5668",g={id:"develop/try/simulation",title:"\u6a21\u62df\u5668",description:"\u5728\u4e24\u4e2a\u8eab\u4efd\u4e4b\u95f4\u7684\u8eab\u4efd\u9a8c\u8bc1\u6a21\u5f0f\u6a21\u62df",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/develop/try/simulation.mdx",sourceDirName:"develop/try",slug:"/develop/try/simulation",permalink:"/zh/docs/develop/try/simulation",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{hide_table_of_contents:!0,sidebar_position:2},sidebar:"userguideSidebar",previous:{title:"VaultysID",permalink:"/zh/docs/develop/try/did"},next:{title:"WebRTC",permalink:"/zh/docs/develop/try/webrtc"}},y={},b=[];function w(e){const t={h1:"h1",header:"header",li:"li",mermaid:"mermaid",p:"p",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"\u6a21\u62df\u5668",children:"\u6a21\u62df\u5668"})}),"\n",(0,s.jsx)(t.p,{children:"\u5728\u4e24\u4e2a\u8eab\u4efd\u4e4b\u95f4\u7684\u8eab\u4efd\u9a8c\u8bc1\u6a21\u5f0f\u6a21\u62df"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"\u6d4f\u89c8\u5668\u4e2d\u7684100%\u53ef\u79fb\u690d\u6027"}),"\n",(0,s.jsx)(t.li,{children:"\u517c\u5bb9\u7684\u5bc6\u7801\u3001\u786c\u4ef6\u5bc6\u94a5\uff08\u4f8b\u5982yubikey\uff09"}),"\n",(0,s.jsx)(t.li,{children:"\u4e0d\u4f7f\u7528\u7b2c\u4e09\u65b9\u4e2d\u7ee7\u6d88\u606f\u6216\u4e8b\u5148\u8bc6\u522bBob\u548cAlice"}),"\n",(0,s.jsx)(t.li,{children:"\u4f7f\u7528\u5171\u4eab\u5bf9\u79f0\u5bc6\u94a5\u52a0\u5bc6\u4ea4\u6362"}),"\n"]}),"\n",(0,s.jsx)(f,{}),"\n",(0,s.jsx)(t.mermaid,{value:"sequenceDiagram\n    participant Store1\n    participant IdManager1\n    participant IdManager2\n    participant Store2\n\n    IdManager1->>IdManager2: \u8bf7\u6c42\u8054\u7cfb\n    IdManager2->>IdManager1: \u63a5\u53d7\u8054\u7cfb\n    IdManager1->>Store1: \u5b58\u50a8\u8054\u7cfb\n    IdManager2->>Store2: \u5b58\u50a8\u8054\u7cfb"})]})}function j(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(w,{...e})}):w(e)}},39287:(e,t,r)=>{"use strict";r.d(t,{n:()=>a});var s=r(63669),n=r(16899);class a{setChannel(e,t,r,s){this.name=t,this.onSend=r,this.onReceive=s,this.otherend=e}static createBidirectionnal(){const e=new a,t=new a;return e.setChannel(t),t.setChannel(e),e}static createEncryptedBidirectionnal(e){e=e||s.Ay.generateKey();const t=s.Ay.encryptChannel(new a,e),r=s.Ay.encryptChannel(new a,e);return t.setChannel(r),r.setChannel(t),t}async send(e){for(;!this.otherend?.resolver;)await(0,n.cb)(10);this.onSend&&await this.onSend(e),this.otherend?.onReceive&&await(this.otherend?.onReceive(e)),this.otherend?.resolver(e)}async start(){}fromConnectionString(e){return new a}getConnectionString(){return""}async receive(){return new Promise((e=>this.resolver=e))}async close(){}}},16899:(e,t,r)=>{"use strict";r.d(t,{cb:()=>a,du:()=>o,vX:()=>l});var s=r(82846),n=r(84686).Buffer;const a=e=>new Promise((t=>setTimeout(t,e))),i=s.VaultysId.createPublicKeyCredentialCreationOptions,l=async e=>{const t=await navigator.credentials.create({publicKey:i(e)});return t?await s.VaultysId.fido2FromAttestation(t):null},o=e=>JSON.stringify(e,((e,t)=>t?.data&&"Buffer"==t?.type?n.from(t.data).toString("base64"):t),2)},14796:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.secureErase=t.fromUTF8=t.fromHex=t.fromBase64=t.toUTF8=t.toHex=t.toBase64=t.secretbox=t.randomBytes=t.hash=t.Buffer=void 0;const n=r(76855),a=s(r(54406)),i=r(84686);Object.defineProperty(t,"Buffer",{enumerable:!0,get:function(){return i.Buffer}});const l=r(14184),o=r(39453);t.randomBytes=e=>i.Buffer.from(n.randomBytes?(0,n.randomBytes)(e):crypto.getRandomValues(new Uint8Array(e)));t.hash=(e,t)=>i.Buffer.from((e=>{const t=e.replaceAll("-","").toLowerCase();return"sha256"===t?l.sha256.create():"sha512"===t?o.sha512.create():"sha224"===t?l.sha224.create():l.sha256.create()})(e).update(t).digest());const c=a.default.secretbox;t.secretbox=c;t.toBase64=e=>i.Buffer.from(e).toString("base64");t.toHex=e=>i.Buffer.from(e).toString("hex");t.toUTF8=e=>i.Buffer.from(e).toString("utf-8");t.fromBase64=e=>i.Buffer.from(e,"base64");t.fromHex=e=>i.Buffer.from(e,"hex");t.fromUTF8=e=>i.Buffer.from(e,"utf-8");t.secureErase=e=>{for(let t=0;t<e.length;t++)e[t]=0}},63669:(e,t,r)=>{"use strict";var s=r(84686).Buffer;t.Yc=t.w=void 0;const n=r(14796);t.w=(e,t)=>{const r=t,a=(0,n.randomBytes)(n.secretbox.nonceLength),i=(0,n.secretbox)(Uint8Array.from(e),a,r),l=new Uint8Array(a.length+i.length);return l.set(a),l.set(i,a.length),s.from(l)};t.Yc=(e,t)=>{const r=t,a=e,i=a.slice(0,n.secretbox.nonceLength),l=a.slice(n.secretbox.nonceLength,e.length),o=n.secretbox.open(l,i,r);if(!o)throw new Error("Could not decrypt message");return s.from(o)};t.Ay={decrypt:t.Yc,encrypt:t.w,encryptChannel:(e,r)=>{const s={apply:(e,s,n)=>e.call(s,(0,t.w)(n[0],r))},n={async apply(e,s,n){const a=await e.call(s);return(0,t.Yc)(a,r)}};return e.send=new Proxy(e.send,s),e.receive=new Proxy(e.receive,n),e},generateKey:()=>(0,n.randomBytes)(32)}},34654:()=>{},34149:()=>{},89780:()=>{},99926:()=>{},90124:()=>{},71220:()=>{},38854:()=>{},98308:()=>{}}]);