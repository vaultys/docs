(self.webpackChunksmartlink_doc=self.webpackChunksmartlink_doc||[]).push([[6646],{77903:(e,t,r)=>{"use strict";r.r(t),r.d(t,{assets:()=>j,contentTitle:()=>b,default:()=>S,frontMatter:()=>g,metadata:()=>v,toc:()=>y});var s=r(86070),n=r(25710),o=r(68171),a=r(81798),i=r(30758),c=r(33275),l=r(3769),d=r(43419),u=r(94198),h=r(74480),f=r(65640);const p=e=>{let{ekey:t,rawdata:r}=e;const[n,o]=(0,i.useState)();return(0,i.useEffect)((()=>{if(!r||!t)return;f.log(r,t);const e=(0,u.decrypt)(r,t),s=(0,d.D4)(e);o((0,h.du)(s))}),[r,t]),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5 border border-slate-500 rounded border-solid p-5",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-center ",children:"Encrypted"}),(0,s.jsx)("pre",{className:"whitespace-normal",children:r?.toString("base64")})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-center ",children:"Decrypted"}),(0,s.jsx)("pre",{children:n})]})]})};var m=r(84686).Buffer;const x=()=>{const[e,t]=(0,i.useState)(),[r,n]=(0,i.useState)(),d=(0,i.useRef)([(0,s.jsx)("div",{children:"waiting for connexion through WebRTC..."})]),[u,h]=(0,i.useState)(!1),[f,x]=(0,i.useState)(0),[g,b]=(0,i.useState)(),[v,j]=(0,i.useState)();(0,i.useEffect)((()=>{(async()=>{const e=(0,a.LocalStorage)("doc_manager");t(await o.IdManager.fromStore(e))})()}));const y={start:()=>(e&&(d.current=[(0,s.jsx)("div",{children:"waiting for connexion through WebRTC..."})]),x(Math.random()),h(!0),d.current),stop:()=>{h(!1),d.current=[(0,s.jsx)("div",{children:"waiting for connexion through WebRTC..."})],x(Math.random())},me:()=>e?.vaultysId.toVersion(1).did,help:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:"'me' - displays this browser page did"}),(0,s.jsx)("div",{children:"'start' - starts a WebRTC connection"}),(0,s.jsx)("div",{children:"'stop' - stops the WebRTC connection"}),(0,s.jsx)("div",{children:"'contacts' - displays this browser page Web of Trust contact DIDs"}),(0,s.jsx)("div",{children:"'history' - your contact audit trails"})]}),contacts:()=>e?.contacts.map((e=>(0,s.jsx)("div",{children:e.toVersion(1).did}))),history:()=>e?.listCertificates().map((e=>(0,s.jsxs)("div",{children:[new Date(e.timestamp).toISOString(),": ",e.protocol,"/",e.service]})))},w=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:"Welcome to the WebRTC test console to interact with the DID of your browser"}),(0,s.jsx)("div",{children:"'help' for all available commands"})]});return(0,s.jsxs)(c.XL,{children:[(0,s.jsxs)("section",{className:"p-5 flex-col md:flex-row flex gap-2 w-full",children:[(0,s.jsxs)("div",{className:"w-96 h-96 min-h-96 flex flex-col items-center justify-center",children:[u&&e&&(0,s.jsx)(l.h,{profile:e,onEncryptionKey:e=>{b(e)},onFail:e=>{d.current.push((0,s.jsxs)("div",{className:"text-red-500 font-bold",children:["Error: ",e]})),x(Math.random())},onData:e=>{j(m.from(e,"base64")),d.current.push((0,s.jsxs)("div",{className:"break-all",children:["Received: ",e]})),x(Math.random())},onSuccess:t=>{n(t),e?.store.save(),d.current.push((0,s.jsxs)("div",{className:"text-green-500 font-bold",children:["Connected to ",t.did," "]})),x(Math.random())}}),!u&&(0,s.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center p-5 bg-opacity-15 bg-black dark:bg-opacity-15 dark:bg-white rounded-lg",children:[" ","Write 'start' in command prompt and get ready with your wallet VaultysID"]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto max-h-96",children:(0,s.jsx)(c.e,{theme:"dark",enableInput:!0,showControlBar:!1,commands:y,welcomeMessage:w})},f)]}),(0,s.jsx)(p,{ekey:g,rawdata:v})]})},g={hide_table_of_contents:!0,sidebar_position:3},b="WebRTC",v={id:"develop/try/webrtc",title:"WebRTC",description:"",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/develop/try/webrtc.mdx",sourceDirName:"develop/try",slug:"/develop/try/webrtc",permalink:"/zh/docs/develop/try/webrtc",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{hide_table_of_contents:!0,sidebar_position:3},sidebar:"userguideSidebar",previous:{title:"\u6a21\u62df\u5668",permalink:"/zh/docs/develop/try/simulation"},next:{title:"\u6309\u9700\u89e3\u5bc6",permalink:"/zh/docs/develop/try/decryptor"}},j={},y=[];function w(e){const t={h1:"h1",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"webrtc",children:"WebRTC"}),"\n",(0,s.jsx)(x,{})]})}function S(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(w,{...e})}):w(e)}},3769:(e,t,r)=>{"use strict";r.d(t,{h:()=>u});var s=r(59280),n=r(30758),o=r(29916),a=r(92259),i=r(86070);function c(e){let{className:t,fingerprint:r}=e;const s=(0,o.D)(r);return r.startsWith("00")?(0,i.jsx)(a.eWW,{className:t}):(0,i.jsx)(o.A,{...s,className:`${t} shrink-0`,shape:"circle",hairColorRandom:!0})}var l=r(84686).Buffer,d=r(65640);const u=e=>{let{profile:t,onEncryptionKey:o,onData:a,onSuccess:u,onFail:h,state:f}=e,p=(0,n.useRef)();const[m,x]=(0,n.useState)(),[g,b]=(0,n.useState)(!1),[v,j]=(0,n.useState)(!1),[y,w]=(0,n.useState)();let S=!1;return(0,n.useEffect)((()=>(S||(S=!0,(async()=>{const e=t.vaultysId?.toVersion(0);if(!e)return h&&h("no Id");const{PeerjsChannel:s}=r(75075);p.current=new s,o&&o(l.from(p.current.key,"hex"));const n=p.current?.start();x("https://wallet.vaultys.net#"+p.current?.getConnectionString()+"&protocol=p2p&service=auth&id="+e.id.toString("hex")),n?.then((async()=>{if(!p.current)return b(!0),h&&h("Could not open communication channel");p.current.conn?.on("data",a);try{const e=await(t?.acceptContact(p.current));return p.current?.close(),e?(j(!0),w(e.toVersion(1)),u&&u(e.toVersion(1))):(b(!0),h&&h("The handshake has failed!"))}catch(g){return b(!0),h&&h("The handshake has failed!")}}))})()),()=>{p.current?.close()})),[f]),(0,n.useEffect)((()=>{d.log(m)}),[m]),g?(0,i.jsx)("div",{children:"Error"}):y?(0,i.jsxs)("div",{className:"rounded-lg shadow-lg p-5 justify-center bg-white dark:bg-slate-900 flex-col flex gap-5 w-64 m-auto font-mono text-sm font-bold",children:[(0,i.jsx)(c,{fingerprint:y.toVersion(1).fingerprint,className:"border border-black border-solid w-24 h-24 m-auto shadow-lg"}),y.toVersion(1).fingerprint]}):m?(0,i.jsx)(s.vP,{text:m,className:"rounded-lg shadow-xl"}):void 0}},74480:(e,t,r)=>{"use strict";r.d(t,{cb:()=>o,du:()=>c,vX:()=>i});var s=r(68171),n=r(84686).Buffer;const o=e=>new Promise((t=>setTimeout(t,e))),a=s.VaultysId.createPublicKeyCredentialCreationOptions,i=async e=>{const t=await navigator.credentials.create({publicKey:a(e)});return t?await s.VaultysId.fido2FromAttestation(t):null},c=e=>JSON.stringify(e,((e,t)=>t?.data&&"Buffer"==t?.type?n.from(t.data).toString("base64"):t),2)},34654:()=>{},34149:()=>{},89780:()=>{},13495:()=>{},99926:()=>{},90124:()=>{},71220:()=>{},38854:()=>{},98308:()=>{}}]);