(self.webpackChunksmartlink_doc=self.webpackChunksmartlink_doc||[]).push([[3158],{65120:(e,t,r)=>{"use strict";r.r(t),r.d(t,{assets:()=>C,contentTitle:()=>S,default:()=>R,frontMatter:()=>k,metadata:()=>N,toc:()=>W});var s=r(86070),n=r(25710),a=r(29336),o=r(27449),c=r(30758),i=r(33275),l=r(3274),d=r(29916),u=r(92259);function h(e){let{className:t,fingerprint:r}=e;const n=(0,d.D)(r);return r.startsWith("00")?(0,s.jsx)(u.eWW,{className:t}):(0,s.jsx)(d.A,{...n,className:`${t} shrink-0`,shape:"circle",hairColorRandom:!0})}var m=r(84686).Buffer,f=r(65640);const p=e=>{let{profile:t,onEncryptionKey:n,onData:a,onSuccess:o,onFail:i,state:d}=e,u=(0,c.useRef)();const[p,x]=(0,c.useState)(),[g,b]=(0,c.useState)(!1),[y,v]=(0,c.useState)(!1),[j,w]=(0,c.useState)();let k=!1;return(0,c.useEffect)((()=>(k||(k=!0,(async()=>{const e=t.vaultysId?.toVersion(0);if(!e)return i&&i("no Id");const{PeerjsChannel:s}=r(90720);u.current=new s,n&&n(m.from(u.current.key,"hex"));const c=u.current?.start();x("https://wallet.vaultys.net#"+u.current?.getConnectionString()+"&protocol=p2p&service=auth&id="+e.id.toString("hex")),c?.then((async()=>{if(!u.current)return b(!0),i&&i("Could not open communication channel");u.current.conn?.on("data",a);try{const e=await(t?.acceptContact(u.current));return u.current?.close(),e?(v(!0),w(e.toVersion(1)),o&&o(e.toVersion(1))):(b(!0),i&&i("The handshake has failed!"))}catch(g){return b(!0),i&&i("The handshake has failed!")}}))})()),()=>{u.current?.close()})),[d]),(0,c.useEffect)((()=>{f.log(p)}),[p]),g?(0,s.jsx)("div",{children:"Error"}):j?(0,s.jsxs)("div",{className:"rounded-lg shadow-lg p-5 justify-center bg-white dark:bg-slate-900 flex-col flex gap-5 w-64 m-auto font-mono text-sm font-bold",children:[(0,s.jsx)(h,{fingerprint:j.toVersion(1).fingerprint,className:"border border-black border-solid w-24 h-24 m-auto shadow-lg"}),j.toVersion(1).fingerprint]}):p?(0,s.jsx)(l.QrCodeElement,{text:p,className:"rounded-lg shadow-xl"}):void 0};var x=r(43419),g=r(36513),b=r(1553),y=r(65640);const v=e=>{let{ekey:t,rawdata:r}=e;const[n,a]=(0,c.useState)();return(0,c.useEffect)((()=>{if(!r||!t)return;y.log(r,t);const e=(0,g.decrypt)(r,t),s=(0,x.D4)(e);a((0,b.du)(s))}),[r,t]),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5 border border-slate-500 rounded border-solid p-5",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-center ",children:"Encrypted"}),(0,s.jsx)("pre",{className:"whitespace-normal",children:r?.toString("base64")})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-center ",children:"Decrypted"}),(0,s.jsx)("pre",{children:n})]})]})};var j=r(84686).Buffer;const w=()=>{const[e,t]=(0,c.useState)(),[r,n]=(0,c.useState)(),l=(0,c.useRef)([(0,s.jsx)("div",{children:"waiting for connexion through WebRTC..."})]),[d,u]=(0,c.useState)(!1),[h,m]=(0,c.useState)(0),[f,x]=(0,c.useState)(),[g,b]=(0,c.useState)();(0,c.useEffect)((()=>{(async()=>{const e=(0,o.LocalStorage)("doc_manager");t(await a.IdManager.fromStore(e))})()}));const y={start:()=>(e&&(l.current=[(0,s.jsx)("div",{children:"waiting for connexion through WebRTC..."})]),m(Math.random()),u(!0),l.current),stop:()=>{u(!1),l.current=[(0,s.jsx)("div",{children:"waiting for connexion through WebRTC..."})],m(Math.random())},me:()=>e?.vaultysId.toVersion(1).did,help:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:"'me' - displays this browser page did"}),(0,s.jsx)("div",{children:"'start' - starts a WebRTC connection"}),(0,s.jsx)("div",{children:"'stop' - stops the WebRTC connection"}),(0,s.jsx)("div",{children:"'contacts' - displays this broaser page Web of Trust contact DIDs"}),(0,s.jsx)("div",{children:"'history' - your contact audit trails"})]}),contacts:()=>e?.contacts.map((e=>(0,s.jsx)("div",{children:e.toVersion(1).did}))),history:()=>e?.listCertificates().map((e=>(0,s.jsxs)("div",{children:[new Date(e.timestamp).toISOString(),": ",e.protocol,"/",e.service]})))},w=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:"Welcome to the WebRTC test console to interact with the DID of your browser"}),(0,s.jsx)("div",{children:"'help' for all available commands"})]});return(0,s.jsxs)(i.XL,{children:[(0,s.jsxs)("section",{className:"p-5 flex-col md:flex-row flex gap-2 w-full",children:[(0,s.jsxs)("div",{className:"w-96 h-96 min-h-96 flex flex-col items-center justify-center",children:[d&&e&&(0,s.jsx)(p,{profile:e,onEncryptionKey:e=>{x(e)},onFail:e=>{l.current.push((0,s.jsxs)("div",{className:"text-red-500 font-bold",children:["Error: ",e]})),m(Math.random())},onData:e=>{b(j.from(e,"base64")),l.current.push((0,s.jsxs)("div",{className:"break-all",children:["Received: ",e]})),m(Math.random())},onSuccess:t=>{n(t),e?.store.save(),l.current.push((0,s.jsxs)("div",{className:"text-green-500 font-bold",children:["Connected to ",t.did," "]})),m(Math.random())}}),!d&&(0,s.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center p-5 bg-opacity-15 bg-black dark:bg-opacity-15 dark:bg-white rounded-lg",children:[" ","Write 'start' in command prompt and get ready with your wallet VaultysID"]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto max-h-96",children:(0,s.jsx)(i.e,{theme:"dark",enableInput:!0,showControlBar:!1,commands:y,welcomeMessage:w})},h)]}),(0,s.jsx)(v,{ekey:f,rawdata:g})]})},k={hide_table_of_contents:!0},S="WebRTC",N={id:"develop/try/webrtc",title:"WebRTC",description:"",source:"@site/docs/develop/try/webrtc.mdx",sourceDirName:"develop/try",slug:"/develop/try/webrtc",permalink:"/en/docs/develop/try/webrtc",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{hide_table_of_contents:!0},sidebar:"userguideSidebar",previous:{title:"Simulator",permalink:"/en/docs/develop/try/simulation"}},C={},W=[];function D(e){const t={h1:"h1",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"webrtc",children:"WebRTC"}),"\n",(0,s.jsx)(w,{})]})}function R(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(D,{...e})}):D(e)}},1553:(e,t,r)=>{"use strict";r.d(t,{cb:()=>o,du:()=>l,vX:()=>i});var s=r(29336),n=r(2080),a=r(84686).Buffer;const o=e=>new Promise((t=>setTimeout(t,e))),c=e=>{const t=/^((?!chrome|android).)*applewebkit/i.test(navigator.userAgent);return{challenge:(0,n.randomBytes)(32),rp:{name:"Vaultys ID"},user:{id:(0,n.randomBytes)(16),name:"Vaultys ID",displayName:"Vaultys Wallet ID"},attestation:t?"none":"direct",authenticatorSelection:{authenticatorAttachment:e?"platform":"cross-platform",residentKey:e?"required":"discouraged",userVerification:"preferred"},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-8},{type:"public-key",alg:-257}]}},i=async e=>{const t=await navigator.credentials.create({publicKey:c(e)});return t?await s.VaultysId.fido2FromAttestation(t):null},l=e=>JSON.stringify(e,((e,t)=>t?.data&&"Buffer"==t?.type?a.from(t.data).toString("base64"):t),2)},34654:()=>{},34149:()=>{},89780:()=>{},13495:()=>{},99926:()=>{},90124:()=>{},71220:()=>{},38854:()=>{},98308:()=>{}}]);