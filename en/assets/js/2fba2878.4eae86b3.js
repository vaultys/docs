(self.webpackChunksmartlink_doc=self.webpackChunksmartlink_doc||[]).push([[8231],{20299:(e,t,s)=>{"use strict";s.r(t),s.d(t,{assets:()=>p,contentTitle:()=>h,default:()=>y,frontMatter:()=>g,metadata:()=>m,toc:()=>x});var n=s(86070),r=s(62907),a=s(82846),o=s(86317),i=s(30758),c=s(3866),l=s(58359);function d(e){let{did:t}=e;const[s,r]=(0,i.useState)([]),[a,o]=(0,i.useState)(),c=(0,i.useRef)(null);(0,i.useEffect)((()=>{r(JSON.parse(localStorage.getItem("messages")??"[]"))}),[]),(0,i.useEffect)((()=>{(()=>{const e=c.current;e&&(e.scrollTop=e.scrollHeight)})()}),[s]);const d=()=>{if(!a)return;o("");const e={date:Date.now(),message:a,did:t};localStorage.setItem("messages",JSON.stringify([...s,e])),r([...s,e])};return(0,n.jsxs)("div",{className:"h-[600px] bg-light dark:bg-dark p-2 rounded-lg flex flex-col gap-4 overflow-hidden",children:[(0,n.jsx)("h2",{children:"Messages"}),(0,n.jsx)("div",{className:"flex flex-col gap-2 flex-grow overflow-auto max-w-full",ref:c,children:s.map((e=>(0,n.jsx)("div",{className:""+(e.did===t?"pl-12":"pr-12"),children:(0,n.jsxs)("div",{className:"w-max max-w-full text-sm flex flex-col gap-1 p-2 rounded-lg "+(e.did===t?"bg-success text-white ml-auto":"bg-light-secondary dark:bg-dark-secondary"),children:[(0,n.jsxs)("div",{className:"flex flex-row gap-2 items-center text-xs",children:[e.did===t?(0,n.jsx)("span",{className:" text-primary",children:"Moi"}):(0,n.jsx)("span",{className:" text-primary dark:text-secondary",children:e.did}),(0,n.jsxs)("span",{className:"text-gray-300",children:[new Date(e.date).toLocaleDateString()," ",new Date(e.date).toLocaleTimeString()]})]}),(0,n.jsx)("span",{children:e.message})]})})))}),(0,n.jsxs)("div",{className:"flex flex-row items-center gap-2  bg-light-secondary dark:bg-dark-secondary p-2 rounded-full",children:[(0,n.jsx)("input",{className:"w-full border-none focus:outline-none",placeholder:"Ecrire un message",value:a,onChange:e=>o(e.target.value),onKeyDown:e=>"Enter"===e.key&&d()}),(0,n.jsx)(l.B07,{className:`w-6 h-6 cursor-pointer hover:scale-110 ${(!a||0===a.length)&&"collapse"}`,onClick:d})]})]})}function u(){const[e,t]=(0,i.useState)(),[s,r]=(0,i.useState)(),[l,u]=(0,i.useState)();(0,i.useEffect)((()=>{(async()=>{const e=(0,o.DT)("doc_manager");t(await a.IdManager.fromStore(e))})(),r(localStorage.getItem("did")??void 0)}),[]);return(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[e&&(0,n.jsx)(n.Fragment,{children:s?(0,n.jsx)("button",{className:"border-none bg-danger py-2 px-4 ml-auto rounded-lg text-white cursor-pointer",onClick:()=>{localStorage.removeItem("did"),r(void 0)},children:"Se d\xe9connecter"}):(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(c.h,{profile:e,onEncryptionKey:e=>{u(e.toString("hex"))},onFail:e=>{},onData:e=>{},onSuccess:e=>{localStorage.setItem("did",e.did),r(e.did)}})})}),s&&(0,n.jsx)(d,{did:s})]})}const g={hide_table_of_contents:!0,sidebar_position:5},h="Messaging",m={id:"develop/try/demo",title:"Messaging",description:"Log in using your VaultysID identity.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/develop/try/demo.mdx",sourceDirName:"develop/try",slug:"/develop/try/demo",permalink:"/en/docs/develop/try/demo",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{hide_table_of_contents:!0,sidebar_position:5},sidebar:"userguideSidebar",previous:{title:"Decrypt on Demand",permalink:"/en/docs/develop/try/decryptor"}},p={},x=[];function f(e){const t={h1:"h1",header:"header",p:"p",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"messaging",children:"Messaging"})}),"\n",(0,n.jsx)(t.p,{children:"Log in using your VaultysID identity.\nIn this demo, communication between your phone (VaultysID) and your PC (browser) is done without an intermediary server, directly peer to peer."}),"\n",(0,n.jsx)(t.p,{children:"Scan the QR code with VaultysID to log in and start writing messages. Make sure your phone is on the same network as your computer."}),"\n",(0,n.jsx)(u,{})]})}function y(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(f,{...e})}):f(e)}},3866:(e,t,s)=>{"use strict";s.d(t,{h:()=>u});var n=s(20563),r=s(30758),a=s(72940),o=s(58359),i=s(86070);function c(e){let{className:t,fingerprint:s}=e;const n=(0,a.D)(s);return s.startsWith("00")?(0,i.jsx)(o.eWW,{className:t}):(0,i.jsx)(a.A,{...n,className:`${t} shrink-0`,shape:"circle",hairColorRandom:!0})}var l=s(84686).Buffer,d=s(65640);const u=e=>{let{profile:t,onEncryptionKey:a,onData:o,onSuccess:u,onFail:g,state:h}=e,m=(0,r.useRef)();const[p,x]=(0,r.useState)(),[f,y]=(0,r.useState)(!1),[j,w]=(0,r.useState)(!1),[v,b]=(0,r.useState)();let S=!1;return(0,r.useEffect)((()=>(S||(S=!0,(async()=>{const e=t.vaultysId?.toVersion(0);if(!e)return g&&g("no Id");const{PeerjsChannel:n}=s(35288);m.current=new n,a&&a(l.from(m.current.key,"hex"));const r=m.current?.start();x("https://wallet.vaultys.net#"+m.current?.getConnectionString()+"&protocol=p2p&service=auth&id="+e.id.toString("hex")),r?.then((async()=>{if(!m.current)return y(!0),g&&g("Could not open communication channel");m.current.conn?.on("data",o);try{const e=await(t?.acceptContact(m.current));return m.current?.close(),e?(w(!0),b(e.toVersion(1)),u&&u(e.toVersion(1))):(y(!0),g&&g("The handshake has failed!"))}catch(f){return y(!0),g&&g("The handshake has failed!")}}))})()),()=>{m.current?.close()})),[h]),(0,r.useEffect)((()=>{d.log(p)}),[p]),f?(0,i.jsx)("div",{children:"Error"}):v?(0,i.jsxs)("div",{className:"rounded-lg shadow-lg p-5 justify-center bg-white dark:bg-slate-900 flex-col flex gap-5 w-64 m-auto font-mono text-sm font-bold",children:[(0,i.jsx)(c,{fingerprint:v.toVersion(1).fingerprint,className:"border border-black border-solid w-24 h-24 m-auto shadow-lg"}),v.toVersion(1).fingerprint]}):p?(0,i.jsx)(n.vP,{text:p,className:"rounded-lg shadow-xl"}):void 0}},34654:()=>{},34149:()=>{},89780:()=>{},35129:()=>{},99926:()=>{},90124:()=>{},71220:()=>{},38854:()=>{},98308:()=>{}}]);